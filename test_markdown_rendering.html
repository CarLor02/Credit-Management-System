<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdownæ¢è¡Œæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            display: flex;
            gap: 20px;
        }
        .column {
            flex: 1;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 5px;
        }
        .column h3 {
            margin-top: 0;
            color: #333;
        }
        .original {
            background-color: #f9f9f9;
            font-family: monospace;
            white-space: pre-wrap;
            font-size: 12px;
        }
        .processed {
            background-color: #f0f8ff;
            font-family: monospace;
            white-space: pre-wrap;
            font-size: 12px;
        }
        .rendered {
            background-color: #fff;
            border: 1px solid #ddd;
            padding: 15px;
            min-height: 200px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .test-input {
            width: 100%;
            height: 150px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <h1>ğŸ”§ Markdownæ¢è¡Œé—®é¢˜æµ‹è¯•</h1>
    
    <div style="margin-bottom: 20px;">
        <h3>æµ‹è¯•å†…å®¹ï¼š</h3>
        <textarea id="testInput" class="test-input" placeholder="è¾“å…¥æµ‹è¯•å†…å®¹...">å°Šè´µçš„è¥¿å®‰å¸‚æ–°å¸Œæœ›åŒ»ç–—å™¨æ¢°æœ‰é™å…¬å¸ï¼š
    ä¸ºè§£å†³è´µå¸èèµ„éš¾ã€èèµ„è´µçš„å®é™…é—®é¢˜ï¼Œæˆ‘å¸ä¸“ä¸šå›¢é˜Ÿç»è¿‡æ·±å…¥è°ƒç ”åˆ†æï¼Œç°ä¸ºè´µå¸æä¾›ä»¥ä¸‹å¾ä¿¡åˆ†ææŠ¥å‘Šã€‚

## ä¼ä¸šåŸºæœ¬ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| ä¼ä¸šåç§° | è¥¿å®‰å¸‚æ–°å¸Œæœ›åŒ»ç–—å™¨æ¢°æœ‰é™å…¬å¸ |
| ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç  | 91610000MA6U123456 |

### ä¸»è¦å‘ç°
1. ä¼ä¸šå¾ä¿¡çŠ¶å†µè‰¯å¥½
2. æ— é‡å¤§è¿çº¦è®°å½•
3. å»ºè®®ç»§ç»­ä¿æŒ</textarea>
        
        <div>
            <button onclick="testOriginal()">æµ‹è¯•åŸå§‹å†…å®¹</button>
            <button onclick="testProcessed()">æµ‹è¯•å¤„ç†åå†…å®¹</button>
            <button onclick="testBoth()">å¯¹æ¯”æµ‹è¯•</button>
        </div>
    </div>

    <div class="container">
        <div class="column">
            <h3>ğŸ“ åŸå§‹å†…å®¹</h3>
            <div id="originalContent" class="original"></div>
            <h4>æ¸²æŸ“ç»“æœï¼š</h4>
            <div id="originalRendered" class="rendered"></div>
        </div>
        
        <div class="column">
            <h3>ğŸ”§ å¤„ç†åå†…å®¹</h3>
            <div id="processedContent" class="processed"></div>
            <h4>æ¸²æŸ“ç»“æœï¼š</h4>
            <div id="processedRendered" class="rendered"></div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿå‰ç«¯çš„preprocessMarkdownå‡½æ•°
        function preprocessMarkdown(content) {
            if (!content) return content;

            let processedContent = content;

            // 1. æ¸…ç†Markdownä»£ç å—æ ‡è®°
            processedContent = processedContent
                .replace(/```markdown\s*\n/gi, '')
                .replace(/```\s*$/gm, '')
                .replace(/```[\w]*\s*\n/gi, '')
                .replace(/```\s*\n/gi, '');

            // ğŸ”§ ä¿®å¤ï¼šå¤„ç†æ¢è¡Œç¬¦é—®é¢˜ - è¿™æ˜¯æ ¸å¿ƒä¿®å¤ï¼
            // å°†å•ä¸ªæ¢è¡Œç¬¦è½¬æ¢ä¸ºMarkdownåŒæ¢è¡Œç¬¦ï¼Œä½†ä¿æŠ¤è¡¨æ ¼å’Œæ ‡é¢˜
            processedContent = processedContent
                // å…ˆä¿æŠ¤è¡¨æ ¼è¡Œï¼ˆåŒ…å«|çš„è¡Œï¼‰
                .replace(/(\|[^|\n]*\|)\n(?!\|)/g, '$1\n\n')
                // ä¿æŠ¤æ ‡é¢˜è¡Œ
                .replace(/(#{1,6}[^\n]*)\n(?!#{1,6})/g, '$1\n\n')
                // å¤„ç†æ™®é€šæ–‡æœ¬çš„å•æ¢è¡Œç¬¦ï¼šå¦‚æœä¸æ˜¯å·²ç»æ˜¯åŒæ¢è¡Œï¼Œå°±è½¬æ¢ä¸ºåŒæ¢è¡Œ
                .replace(/([^\n])\n([^\n])/g, '$1\n\n$2')
                // æ¸…ç†å¯èƒ½äº§ç”Ÿçš„ä¸‰ä¸ªæˆ–æ›´å¤šè¿ç»­æ¢è¡Œç¬¦
                .replace(/\n{3,}/g, '\n\n');

            // 2. ç¡®ä¿æ ‡é¢˜å‰æœ‰æ¢è¡Œç¬¦ï¼ˆæ ¸å¿ƒä¿®å¤ï¼‰
            processedContent = processedContent
                // åœ¨æ ‡é¢˜å‰æ·»åŠ åŒæ¢è¡Œç¬¦ï¼ˆé™¤äº†æ–‡æ¡£å¼€å¤´ï¼‰
                .replace(/([^\n])(#{1,6}\s)/g, '$1\n\n$2')
                // ç¡®ä¿#å·åé¢æœ‰ç©ºæ ¼
                .replace(/^(#{1,6})([^#\s])/gm, '$1 $2');

            // 3. å¤„ç†æ²¡æœ‰#å·çš„æ ‡é¢˜è¡Œ
            processedContent = processedContent.replace(/^(\s*)(ç¬¬[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å\d]+[èŠ‚ç« ][^\n]*)/gm, (match, spaces, title) => {
                if (!title.startsWith('#')) {
                    return `${spaces}\n\n### ${title}`;
                }
                return match;
            });

            // 4. ğŸ”§ ä¿®å¤ï¼šæ”¹è¿›è¡¨æ ¼æ ¼å¼å¤„ç†ï¼Œé¿å…åœ¨è¡¨æ ¼è¡Œä¹‹é—´æ·»åŠ ç©ºè¡Œ
            processedContent = processedContent
                // ç¡®ä¿è¡¨æ ¼å‰åæœ‰ç©ºè¡Œï¼Œä½†ä¸åœ¨è¡¨æ ¼è¡Œä¹‹é—´æ·»åŠ ç©ºè¡Œ
                .replace(/([^\n])\n(\|.*\|)/g, '$1\n\n$2')  // è¡¨æ ¼å‰åŠ ç©ºè¡Œ
                .replace(/(\|.*\|)\n([^|\n])/g, '$1\n\n$2')  // è¡¨æ ¼ååŠ ç©ºè¡Œ
                // æ¸…ç†è¡¨æ ¼å†…éƒ¨å¯èƒ½çš„å¤šä½™ç©ºè¡Œ
                .replace(/(\|.*\|)\n\n+(\|.*\|)/g, '$1\n$2')  // ç§»é™¤è¡¨æ ¼è¡Œä¹‹é—´çš„ç©ºè¡Œ
                // æ¯è¡Œå•å…ƒæ ¼å¯¹é½å¤„ç† - æ›´å®‰å…¨çš„å¤„ç†æ–¹å¼
                .replace(/^\|.*\|$/gm, line => {
                    // åªå¤„ç†çœŸæ­£çš„è¡¨æ ¼è¡Œï¼Œé¿å…å¤„ç†åˆ†éš”ç¬¦è¡Œ
                    if (line.includes('---')) {
                        return line; // ä¿æŒåˆ†éš”ç¬¦è¡Œä¸å˜
                    }
                    const cells = line.split('|');
                    if (cells.length >= 3) { // è‡³å°‘æœ‰å¼€å§‹|ã€å†…å®¹ã€ç»“æŸ|
                        return '| ' + cells.slice(1, -1).map(cell => cell.trim()).join(' | ') + ' |';
                    }
                    return line;
                });

            // 5. æ¸…ç†è¿‡å¤šçš„è¿ç»­ç©ºè¡Œ
            processedContent = processedContent.replace(/\n{4,}/g, '\n\n\n');

            // æ³¨æ„ï¼šä¸ä½¿ç”¨ .trim() ä»¥ä¿ç•™é‡è¦çš„æ¢è¡Œç¬¦å’Œç©ºæ ¼
            return processedContent;
        }

        function testOriginal() {
            const content = document.getElementById('testInput').value;
            document.getElementById('originalContent').textContent = content;
            document.getElementById('originalRendered').innerHTML = marked.parse(content);
        }

        function testProcessed() {
            const content = document.getElementById('testInput').value;
            const processed = preprocessMarkdown(content);
            document.getElementById('processedContent').textContent = processed;
            document.getElementById('processedRendered').innerHTML = marked.parse(processed);
        }

        function testBoth() {
            testOriginal();
            testProcessed();
        }

        // åˆå§‹åŒ–æµ‹è¯•
        window.onload = function() {
            testBoth();
        };
    </script>
</body>
</html>
